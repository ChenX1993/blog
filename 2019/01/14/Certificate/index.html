<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-flash.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="iOS/Mac 设备（系统）使用 App Provisioning Profile（Code Signing Identity）中的开发证书来判断App的合法性： 若用证书公钥能成功解密出 App（executable bundle）的内容摘要（_CodeSignature），证明此 App 确乃认证开发者发布，即来源可信； 再对 App（executable bundle）本身使用哈希算法计算摘">
<meta property="og:type" content="article">
<meta property="og:title" content="Certificate">
<meta property="og:url" content="https://masxch.com/2019/01/14/Certificate/index.html">
<meta property="og:site_name" content="Chen&#39;s Note">
<meta property="og:description" content="iOS/Mac 设备（系统）使用 App Provisioning Profile（Code Signing Identity）中的开发证书来判断App的合法性： 若用证书公钥能成功解密出 App（executable bundle）的内容摘要（_CodeSignature），证明此 App 确乃认证开发者发布，即来源可信； 再对 App（executable bundle）本身使用哈希算法计算摘">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://lh3.googleusercontent.com/ZpTN3usvh2HHymu4R-MsxKu3Z1e4yi38z74wGw56QjIeS44izExBrk0J9dHA8vukgsGoYxhAzR9pVCbzvWX-I8_hybfPBwrf8cOThOMJ7qlY-wSHjtpY1c8yaLZXN0MYrknsTfLeZ4fHzjNUOj92yel9iIFwN-RX2CIWU9FEidnnVCDK7Q-ayMBRptyc9suXDaFjVqHK0d9MqFPY8ZFkY2eCuxDhTueTjdGC6oS31KkryXjMKc-tQWIBtbK4sJduu67s6W5kj5lkRjUSC5az7uOTr6ep7nPf5pDE70cYxlrZlcY6uQXCewbOYFTJ9N-jp6REVJP_JCl98IuGPXht0V3unO-hvo3zd_5PQuTc1YiYwagIgj6jz8OOz1Tbw_jCNbLNAdJDAPlKUgAdAfdOtSQxvPPZS-YgNwkn_uRXm1gIq7zR1s2bp5e16IhKyCY3xxZeq-082sp-5bt_nnX4ZtjYYQyCiG2k7Ye76MyTNixlxhG9o24AARH4DW4IK5hcwfXcocg6Et9CY8yD7ZtA2asUV7oTIIK0Euof27e5FtE_lCB1CGzewfrPC9zgnqVnzjuQXRPknkzbDXEAzAzUN9DBPzq-xYj1iHFyBCWL0SASldyKjiyBZHOPcQUzoB8=w618-h377-no">
<meta property="og:image" content="https://photos.app.goo.gl/hz5E7Jxxx1V4Ft1Q9">
<meta property="og:image" content="https://photos.app.goo.gl/uxfLkV8cAcNTrps17">
<meta property="og:image" content="https://lh3.googleusercontent.com/EtW_nTp-eVQk3pzFIW0-z0kEtsnY7G0OCDK_qOLBdYp6ddyNIeDwgWU3o6ACAoWimFKRHiX46o3cTtDcvJ-7srtj-Q9wCTbGazzfTMnsPZ3XPAvBJHcBTXOOOgFo_XHdl_HSYP47XxTur0exDpVh_sGEooE14nm2rK0oyEqzhNF6UnpYD6HorHTDE0b9PRp0msMZqPh3YEJDaBl2q6eOBKSvalyr2HwSpOEuF_h2VdHN14uAf4xWGIMv25Kl5RHNWUJotoAhg4D1qQm-k6HNqTB7cLmKJYecT7XIOdipCdvJj1_42O5YJ8lNnSN8Xq8UuAUH0evhsudRe9vf1DBttl-fK-OFGzQaeET5i6iPJLc0ELjAZBUelgrCBD3qyBSnL3KAwsvaxcVxK6MY2sjDDFZxe6ZHdVTtadtg8HQlD3g3sjzWNkSOdaZcVI8oEaYNP-5nCencGAF4RAa9q9AQSOT_tPa04SR9x6CJtF6IFtwyDFoLd0CjEzX96_NQ1fc9a3MUISbLAMU7OFJLMEQUS6Q7u7s5l0hTkfza-gn5nkutRb-PGoy7Va4P7W3jmLvQfmP-lZm4DOC3zFfPGDGs5xniHYezxxVN1eAdQnB0MLt96qWjNulW_U4LBG0uOzw=w696-h471-no">
<meta property="og:image" content="https://lh3.googleusercontent.com/18e1ZVR7Z6KFxhSxEeltpwqLUbRy54p5cIyYBH5vAoZCxRp1ZhGxsL7FjYQ7cYtS2Mw41UjIM1JzbBNosNV-WvkSIY2OSbpldG4edz4PGlmSWWOHXXC1QS0RjGroP-fgEuuGlsk9dV9C4s-WbatalBmS5IbJDWfKJJ9Xcj8M3Sw5y646MUErxjNwnKNRwF__MWPRDmuAlKjve4KifQMxUKSkhleO--ROaQ4LgrQmbmWIzZO-ECFZOVFSjwZr0wPi2LvdFV0WkcMqkHRNeqQlwv3QTfmzKHxKpWsZggWyIaPtnMj8SLk1VnTW-eYVZTvXfjewiN6sbiDJqQ6lfAgTbt0nuh9bWf58utJbUeWWd4c28batgC0Fo83s7ggAVc7gU8uaf2Fd-qq84Ou1_RZ8F1YCCnoWmRGTXU5oPySQ1AGuAHKWjOxz40eZEl9zknwlMfInyUeCqKdRzQqAQxO7fe7AHd9JVQVPKCKBvqL3gPe9vZIyEv4mlZxdDkVE5l9D0QdxXMiO3oUxg8-GA_g9qvXR-Rgo_95BuH4gXUDUuPnm3-73xCwwOffcCUVMbcTsERxhTgtZwQ0CIKzwKiuGd4EN4oF5mIFlsTaTUEc__xinoI69HfcRLOrfsHSXeDc=w697-h573-no">
<meta property="og:updated_time" content="2019-01-16T08:47:53.752Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Certificate">
<meta name="twitter:description" content="iOS/Mac 设备（系统）使用 App Provisioning Profile（Code Signing Identity）中的开发证书来判断App的合法性： 若用证书公钥能成功解密出 App（executable bundle）的内容摘要（_CodeSignature），证明此 App 确乃认证开发者发布，即来源可信； 再对 App（executable bundle）本身使用哈希算法计算摘">
<meta name="twitter:image" content="https://lh3.googleusercontent.com/ZpTN3usvh2HHymu4R-MsxKu3Z1e4yi38z74wGw56QjIeS44izExBrk0J9dHA8vukgsGoYxhAzR9pVCbzvWX-I8_hybfPBwrf8cOThOMJ7qlY-wSHjtpY1c8yaLZXN0MYrknsTfLeZ4fHzjNUOj92yel9iIFwN-RX2CIWU9FEidnnVCDK7Q-ayMBRptyc9suXDaFjVqHK0d9MqFPY8ZFkY2eCuxDhTueTjdGC6oS31KkryXjMKc-tQWIBtbK4sJduu67s6W5kj5lkRjUSC5az7uOTr6ep7nPf5pDE70cYxlrZlcY6uQXCewbOYFTJ9N-jp6REVJP_JCl98IuGPXht0V3unO-hvo3zd_5PQuTc1YiYwagIgj6jz8OOz1Tbw_jCNbLNAdJDAPlKUgAdAfdOtSQxvPPZS-YgNwkn_uRXm1gIq7zR1s2bp5e16IhKyCY3xxZeq-082sp-5bt_nnX4ZtjYYQyCiG2k7Ye76MyTNixlxhG9o24AARH4DW4IK5hcwfXcocg6Et9CY8yD7ZtA2asUV7oTIIK0Euof27e5FtE_lCB1CGzewfrPC9zgnqVnzjuQXRPknkzbDXEAzAzUN9DBPzq-xYj1iHFyBCWL0SASldyKjiyBZHOPcQUzoB8=w618-h377-no">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://masxch.com/2019/01/14/Certificate/">





  <title>Certificate | Chen's Note</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Chen's Note</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Cast a code eye, on Life on Death</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-todo">
          <a href="/TODO/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-list-ul"></i> <br>
            
            TODO
          </a>
        </li>
      
        
        <li class="menu-item menu-item-colors">
          <a href="/colors/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-adjust"></i> <br>
            
            colors
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://masxch.com/2019/01/14/Certificate/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Chen Xu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chen's Note">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Certificate</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-14T19:28:58+00:00">
                2019-01-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/14/Certificate/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/01/14/Certificate/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/01/14/Certificate/" class="leancloud_visitors" data-flag-title="Certificate">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Visitors&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="iOS-Mac-设备（系统）使用-App-Provisioning-Profile（Code-Signing-Identity）中的开发证书来判断App的合法性："><a href="#iOS-Mac-设备（系统）使用-App-Provisioning-Profile（Code-Signing-Identity）中的开发证书来判断App的合法性：" class="headerlink" title="iOS/Mac 设备（系统）使用 App Provisioning Profile（Code Signing Identity）中的开发证书来判断App的合法性："></a>iOS/Mac 设备（系统）使用 App Provisioning Profile（Code Signing Identity）中的开发证书来判断App的合法性：</h2><ul>
<li>若用证书公钥能成功解密出 App（executable bundle）的内容摘要（_CodeSignature），证明此 App 确乃认证开发者发布，即来源可信；</li>
<li>再对 App（executable bundle）本身使用哈希算法计算摘要，若与上一步得到的摘要一致，则证明此 App 未被篡改过，即内容完整。</li>
</ul>
<p><strong>CSR: Certificate Signing Request</strong><br><strong>Only Certificates: .p7b or .cer or .pem file</strong></p>
<blockquote>
<p>If Keychain Access shows a certificate in your personal keychain, but it doesn’t show it in the “My Certificates” list, it means you imported just a certificate but not the private key that goes with it, so OS X can’t tell that it’s truly “yours”.</p>
</blockquote>
<p>Certificate is the proof that the public key belongs to the Owner in the certificate or not.<br>prove that a certificate is yours, you must have the private key that forms a matched set with the public key contained in the certificate.</p>
<p><a href="https://superuser.com/questions/936840/add-to-my-certificates-in-keychain-access-mac-os-10-10" target="_blank" rel="noopener">https://superuser.com/questions/936840/add-to-my-certificates-in-keychain-access-mac-os-10-10</a><br><a href="https://blog.csdn.net/phunxm/article/details/42685597" target="_blank" rel="noopener">cn ver reference1</a><br><a href="https://www.cnblogs.com/A--G/p/4627590.html" target="_blank" rel="noopener">cn ver reference2</a></p>
<h1 id="iOS-Provisioning-Profile-and-Code-Signing"><a href="#iOS-Provisioning-Profile-and-Code-Signing" class="headerlink" title="iOS Provisioning Profile and Code Signing"></a>iOS Provisioning Profile and Code Signing</h1><h2 id="1-App-ID-bundle-identifier"><a href="#1-App-ID-bundle-identifier" class="headerlink" title="1.App ID(bundle identifier)"></a>1.App ID(bundle identifier)</h2><p>App ID is Product ID<br>App ID应该和bundle identifier一致(Explicit)或者匹配(Wildcard)<br>reverse-domian-name, Company ID as Prefix(com.apple.garageband)<br>Explicit App ID: com.apple.garageband<br>Wildcard App ID: com.apple.*</p>
<h2 id="2-Device"><a href="#2-Device" class="headerlink" title="2.Device"></a>2.Device</h2><p>UDID<br><code>iTunes-&gt;Summary</code> or <code>Xcode-&gt;WIndow-&gt;Devices</code></p>
<ul>
<li>Apps signed by you or your team run only on designated development devices.</li>
<li>Apps run only on the test devices you specify.</li>
</ul>
<h2 id="3-Certificate"><a href="#3-Certificate" class="headerlink" title="3.Certificate"></a>3.Certificate</h2><h3 id="iOS-certificate"><a href="#iOS-certificate" class="headerlink" title="iOS certificate"></a>iOS certificate</h3><ul>
<li>Development: identifies you, as a team member, in a development provisioning profile that allows apps signed by you to launch on devices. </li>
<li>Production(Distribution): identifies<br>your team or organization in a distribution provisioning profile and allows you to submit  your app to the store. Only a team agent or an admin can create a distribution certificate.<br>Individual Account:iOS Development/Production 2 Max for each.  <h3 id="Root-Certificate"><a href="#Root-Certificate" class="headerlink" title="Root Certificate"></a>Root Certificate</h3>Apple Certification Authority(Apple Root CA)<br>  -&gt; Apple Worldwide Developer Relations Cerification Authority(Subordinate CA)  <pre><code>-&gt; AppleWWDRCA.cer(Intermediate Certificates)  
     -&gt;Certificate for Development 
</code></pre><h2 id="4-CSR-Cerificate-Signing-Request"><a href="#4-CSR-Cerificate-Signing-Request" class="headerlink" title="4.CSR: Cerificate Signing Request"></a>4.CSR: Cerificate Signing Request</h2><h2 id="5-Provisioning-Profiles"><a href="#5-Provisioning-Profiles" class="headerlink" title="5.Provisioning Profiles"></a>5.Provisioning Profiles</h2><strong>App ID, Devices, Development Certificates</strong><br><img src="https://lh3.googleusercontent.com/ZpTN3usvh2HHymu4R-MsxKu3Z1e4yi38z74wGw56QjIeS44izExBrk0J9dHA8vukgsGoYxhAzR9pVCbzvWX-I8_hybfPBwrf8cOThOMJ7qlY-wSHjtpY1c8yaLZXN0MYrknsTfLeZ4fHzjNUOj92yel9iIFwN-RX2CIWU9FEidnnVCDK7Q-ayMBRptyc9suXDaFjVqHK0d9MqFPY8ZFkY2eCuxDhTueTjdGC6oS31KkryXjMKc-tQWIBtbK4sJduu67s6W5kj5lkRjUSC5az7uOTr6ep7nPf5pDE70cYxlrZlcY6uQXCewbOYFTJ9N-jp6REVJP_JCl98IuGPXht0V3unO-hvo3zd_5PQuTc1YiYwagIgj6jz8OOz1Tbw_jCNbLNAdJDAPlKUgAdAfdOtSQxvPPZS-YgNwkn_uRXm1gIq7zR1s2bp5e16IhKyCY3xxZeq-082sp-5bt_nnX4ZtjYYQyCiG2k7Ye76MyTNixlxhG9o24AARH4DW4IK5hcwfXcocg6Et9CY8yD7ZtA2asUV7oTIIK0Euof27e5FtE_lCB1CGzewfrPC9zgnqVnzjuQXRPknkzbDXEAzAzUN9DBPzq-xYj1iHFyBCWL0SASldyKjiyBZHOPcQUzoB8=w618-h377-no" alt=""></li>
</ul>
<p>如果要打包或者在真机上运行一个APP，一般要经历以下三步：</p>
<ul>
<li>首先，需要证书对应的私钥来进行签名，用于标识这个APP是合法、安全、完整的</li>
<li>其次，需要指明它的App ID，并且验证Bundle ID是否与其一致；</li>
<li>然后，如果是真机调试，需要确认这台设备是否授权运行该APP。<br>Provisioning Profile把这些信息全部打包在一起，方便我们在调试和发布程序打包时使用。这样，只要在不同的情况下选择不同的Provisioning Profile文件就可以了。</li>
</ul>
<p>Provisioning Profile也分为Development和Distribution两类，有效期同Certificate一样。Distribution版本的ProvisioningProfile主要用于提交App Store审核，其中不指定开发测试的Devices（0，unlimited）。App ID为Wildcard App ID。App Store审核通过上架后，允许所有iOS设备（Deployment Target）上安装运行该App。</p>
<h2 id="6-Team-Provisioning-Profile"><a href="#6-Team-Provisioning-Profile" class="headerlink" title="6.Team Provisioning Profile"></a>6.Team Provisioning Profile</h2><p><img src="https://photos.app.goo.gl/hz5E7Jxxx1V4Ft1Q9" alt=""><br><img src="https://photos.app.goo.gl/uxfLkV8cAcNTrps17" alt=""></p>
<h2 id="7-Cetificate-amp-Signature"><a href="#7-Cetificate-amp-Signature" class="headerlink" title="7.Cetificate &amp; Signature"></a>7.Cetificate &amp; Signature</h2><p><img src="https://lh3.googleusercontent.com/EtW_nTp-eVQk3pzFIW0-z0kEtsnY7G0OCDK_qOLBdYp6ddyNIeDwgWU3o6ACAoWimFKRHiX46o3cTtDcvJ-7srtj-Q9wCTbGazzfTMnsPZ3XPAvBJHcBTXOOOgFo_XHdl_HSYP47XxTur0exDpVh_sGEooE14nm2rK0oyEqzhNF6UnpYD6HorHTDE0b9PRp0msMZqPh3YEJDaBl2q6eOBKSvalyr2HwSpOEuF_h2VdHN14uAf4xWGIMv25Kl5RHNWUJotoAhg4D1qQm-k6HNqTB7cLmKJYecT7XIOdipCdvJj1_42O5YJ8lNnSN8Xq8UuAUH0evhsudRe9vf1DBttl-fK-OFGzQaeET5i6iPJLc0ELjAZBUelgrCBD3qyBSnL3KAwsvaxcVxK6MY2sjDDFZxe6ZHdVTtadtg8HQlD3g3sjzWNkSOdaZcVI8oEaYNP-5nCencGAF4RAa9q9AQSOT_tPa04SR9x6CJtF6IFtwyDFoLd0CjEzX96_NQ1fc9a3MUISbLAMU7OFJLMEQUS6Q7u7s5l0hTkfza-gn5nkutRb-PGoy7Va4P7W3jmLvQfmP-lZm4DOC3zFfPGDGs5xniHYezxxVN1eAdQnB0MLt96qWjNulW_U4LBG0uOzw=w696-h471-no" alt=""><br><img src="https://lh3.googleusercontent.com/18e1ZVR7Z6KFxhSxEeltpwqLUbRy54p5cIyYBH5vAoZCxRp1ZhGxsL7FjYQ7cYtS2Mw41UjIM1JzbBNosNV-WvkSIY2OSbpldG4edz4PGlmSWWOHXXC1QS0RjGroP-fgEuuGlsk9dV9C4s-WbatalBmS5IbJDWfKJJ9Xcj8M3Sw5y646MUErxjNwnKNRwF__MWPRDmuAlKjve4KifQMxUKSkhleO--ROaQ4LgrQmbmWIzZO-ECFZOVFSjwZr0wPi2LvdFV0WkcMqkHRNeqQlwv3QTfmzKHxKpWsZggWyIaPtnMj8SLk1VnTW-eYVZTvXfjewiN6sbiDJqQ6lfAgTbt0nuh9bWf58utJbUeWWd4c28batgC0Fo83s7ggAVc7gU8uaf2Fd-qq84Ou1_RZ8F1YCCnoWmRGTXU5oPySQ1AGuAHKWjOxz40eZEl9zknwlMfInyUeCqKdRzQqAQxO7fe7AHd9JVQVPKCKBvqL3gPe9vZIyEv4mlZxdDkVE5l9D0QdxXMiO3oUxg8-GA_g9qvXR-Rgo_95BuH4gXUDUuPnm3-73xCwwOffcCUVMbcTsERxhTgtZwQ0CIKzwKiuGd4EN4oF5mIFlsTaTUEc__xinoI69HfcRLOrfsHSXeDc=w697-h573-no" alt=""></p>
<h2 id="7-share-development-account-amoung-multi-machines"><a href="#7-share-development-account-amoung-multi-machines" class="headerlink" title="7.share development account amoung multi machines"></a>7.share development account amoung multi machines</h2><ol>
<li>Xcode export development account(<em>.developmentprofile) or PKCS12 File(</em>.p12)</li>
<li>Keychain Access export PKCS12File(*.p12)</li>
</ol>
<hr>
<p>Short version:<br>You can’t use it as your certificate unless you have the private key that forms a matched set with the public key that’s in the certificate. Go find where you left your private key and import that into the keychain, and Keychain Access will automatically see that it matches with the public key in that certificate and start showing that certificate in the “My Certificates” list.</p>
<p>Long version:<br>Certificates are public documents that you can freely distribute. They are just a way to securely link your identity (i.e. identifying information like your full name, username, email address, etc.) to your public key.</p>
<p>Since certificates are publicly distributable, simply having a copy of a certificate is not proof you are the person named in the certificate, or that the public key in the certificate is truly your public key.</p>
<p>To be able to prove that a certificate is yours, you must have the private key that forms a matched set with the public key contained in the certificate.</p>
<p>If you just have a .p7b or .cer or .pem file, it most likely just contains a certificate, but not the private key that goes with it.</p>
<p>Private keys must be kept completely secure and private and never given to anyone else. When stored on disk, they should be stored in an encrypted file that you need a passphrase to decrypt. The typical way to securely store a certificate along with the matching private key in an encrypted, password-protected file, is a .p12 (PKCS#12) file. See if you already have a .p12 file somewhere.</p>
<p>If Keychain Access shows a certificate in your personal keychain, but it doesn’t show it in the “My Certificates” list, it means you imported just a certificate but not the private key that goes with it, so OS X can’t tell that it’s truly “yours”.</p>
<p>You need to go find where your private key was stored when you first generated your public/private key pair. Generating a key pair is the first step toward getting a certificate. First a key pair is generated, then the public key, along with your identity information, is put into a Certificate Signing Request (a.k.a. CSR, req), and sent off to a Certificate Authority (CA) to be signed. The CA is supposed to verify your identity information and your public key, and then if it all checks out, they sign the CSR, creating a certificate. The signed certificate is sent back to you, and you have to match it back up with the private key you’d generated in the first step, in order to truly use it.</p>
<p>Note that the role of CA is nothing terribly special. It doesn’t have to be some corporation like Verisign. Every personal computer OS contains all the software necessary to act as a CA. Keychain Access’s Certificate Assistant feature will even walk you through setting up your CA setup for your own private use.</p>
<p>If you don’t remember generating a key pair, you were probably using some software that did it automatically for you. For example, there’s a special HTML tag that CA websites can use on their CSR web forms that tells your web browser to automatically generate a key pair and submit just the public key along with the web form. When you use Safari on such a form, the private key is stored in the user keychain for the OS X user account you’re logged into. When you use IE in Windows on such a form, the private key is stored in the Windows equivalent of that (Microsoft calls this the user’s “Certificate Store”; “store” as in “storage container” not “retail shop” :-).</p>
<p>I can’t tell you where your private key is because I don’t know what software you used to create it, and even if I knew that, I wouldn’t know for sure where you told that software to save your private key. You’ll probably have to sleuth that out yourself.</p>
<p>If you can’t find your private key, you may need to consider it compromised and revoke your certificate (you may need to contact your CA to do that) and start over by generating a new key pair, creating a new CSR, having a CA sign it and issue a certificate, match it up with the new private key, etc. This is kind of like realizing that you’re missing a copy of your house key, and choosing to have a locksmith rekey all your door locks just to be safe.</p>
<p>tl;dr: Go find your private key and import it into the keychain.</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/01/14/Markdown-grammar/" rel="next" title="Markdown Grammar">
                <i class="fa fa-chevron-left"></i> Markdown Grammar
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/01/14/Flask/" rel="prev" title="Flask">
                Flask <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="Chen Xu">
            
              <p class="site-author-name" itemprop="name">Chen Xu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">13</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/chenx1993" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="xc454981894@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://twitter.com/yourname" target="_blank" title="Twitter">
                      
                        <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.facebook.com/yourname" target="_blank" title="FB Page">
                      
                        <i class="fa fa-fw fa-facebook"></i>FB Page</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#iOS-Mac-设备（系统）使用-App-Provisioning-Profile（Code-Signing-Identity）中的开发证书来判断App的合法性："><span class="nav-number">1.</span> <span class="nav-text">iOS/Mac 设备（系统）使用 App Provisioning Profile（Code Signing Identity）中的开发证书来判断App的合法性：</span></a></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#iOS-Provisioning-Profile-and-Code-Signing"><span class="nav-number"></span> <span class="nav-text">iOS Provisioning Profile and Code Signing</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-App-ID-bundle-identifier"><span class="nav-number">1.</span> <span class="nav-text">1.App ID(bundle identifier)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Device"><span class="nav-number">2.</span> <span class="nav-text">2.Device</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Certificate"><span class="nav-number">3.</span> <span class="nav-text">3.Certificate</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#iOS-certificate"><span class="nav-number">3.1.</span> <span class="nav-text">iOS certificate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Root-Certificate"><span class="nav-number">3.2.</span> <span class="nav-text">Root Certificate</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-CSR-Cerificate-Signing-Request"><span class="nav-number">4.</span> <span class="nav-text">4.CSR: Cerificate Signing Request</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Provisioning-Profiles"><span class="nav-number">5.</span> <span class="nav-text">5.Provisioning Profiles</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-Team-Provisioning-Profile"><span class="nav-number">6.</span> <span class="nav-text">6.Team Provisioning Profile</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-Cetificate-amp-Signature"><span class="nav-number">7.</span> <span class="nav-text">7.Cetificate &amp; Signature</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-share-development-account-amoung-multi-machines"><span class="nav-number">8.</span> <span class="nav-text">7.share development account amoung multi machines</span></a></li></ol></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chen Xu</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  

    
      <script id="dsq-count-scr" src="https://hexoBlog.disqus.com/count.js" async></script>
    

    
      <script type="text/javascript">
        var disqus_config = function () {
          this.page.url = 'https://masxch.com/2019/01/14/Certificate/';
          this.page.identifier = '2019/01/14/Certificate/';
          this.page.title = 'Certificate';
        };
        var d = document, s = d.createElement('script');
        s.src = 'https://hexoBlog.disqus.com/embed.js';
        s.setAttribute('data-timestamp', '' + +new Date());
        (d.head || d.body).appendChild(s);
      </script>
    

  




	





  














  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("P1CEH30a4dLFHP4R94ShSxhc-gzGzoHsz", "jcI2nGsvuVuczWErsmNJ5jdS");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
